{% extends 'base.html' %}

{% block content %}

<style>
    #calendar {
        max-width: 1000px;
        margin: 40px auto;
        padding: 0 10px;
        font-size: 14px;
    }

    .fc-title {
        position: relative;
        display: block;
        font-size: .85em;
        line-height: 1.4;
        border-radius: 3px;
        border: 1px solid #3788d8;
    }

    .fc h2 {
        font-size: 25px;
    }
</style>

<body data-menu="vertical-menu" class="vertical-layout vertical-menu 2-columns container boxed-layout menu-collapsed">

    <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
        <!-- Navbar Brand-->
        <a class="navbar-brand ps-3" href="/dashboard">Portal</a>
    </nav>

    <!-- urls -->
    <div id="layoutSidenav">
        <div id="layoutSidenav_nav">
            <nav class="sb-sidenav accordion sb-sidenav-light" id="sidenavAccordion">
                <div class="sb-sidenav-menu">
                    <div class="nav">
                        <!-- main--->
                        <div class="sb-sidenav-menu-heading">Main</div>
                        <a class="nav-link" href="/dashboard">
                            <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                            Dashboard
                        </a>
                        <!-- teacher -->
                        <div class="sb-sidenav-menu-heading">Teacher</div>
                        <a class="nav-link" href="#">
                            <div class="sb-nav-link-icon"><i class="fa-solid fa-handshake"></i></i></div>
                            Meetings
                        </a>
                        <a class="nav-link" href="#">
                            <div class="sb-nav-link-icon"><i class="fa-sharp fa-solid fa-graduation-cap"></i></div>
                            Students
                        </a>
                        <a class="nav-link" href="#">
                            <div class="sb-nav-link-icon"><i class="fa-solid fa-chalkboard-user"></i></div>
                            Teachers
                        </a>
                        <a class="nav-link" href="#">
                            <div class="sb-nav-link-icon"><i class="fa-sharp fa-solid fa-school"></i></div>
                            Classes
                        </a>
                        <!--student-->
                        <div class="sb-sidenav-menu-heading">Student</div>
                        <a class="nav-link" href="#">
                            <div class="sb-nav-link-icon"><i class="fa-solid fa-clipboard-user"></i></div>
                            Attendance
                        </a>
                        <!-- account-->
                        <div class="sb-sidenav-menu-heading">Account</div>

                        <a class="nav-link" href="/logout">
                            <div class="sb-nav-link-icon"><i class="fas fa-user"></i></div>
                            Logout
                        </a>

                    </div>
                </div>
                <div class="sb-sidenav-footer">
                    <p>You are logged in.</p>
                    <div class="small">Logged in as: {{ user }}</div>
                </div>
            </nav>
        </div>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/locale/nl.js'></script>

        <!-- calendar -->
        <div id="layoutSidenav_content">
            <main>
                <div id='calendar'></div>
            </main>
            <script>

                var calendar = $('#calendar').fullCalendar({

                    slotLabelFormat: ['H:mm'],

                    header: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'month,agendaWeek,agendaDay,listMonth'

                    },

                    locale: 'nl',
                    weekNumbers: true,
                    defaultView: 'agendaWeek',
                    selectable: true,
                    selectHelper: true,
                    events: '/events',
                    eventColor: '#428bca',
                    theme: false,

                    // Handle the creation of new events
                    select: function (start, end) {
                        var title = prompt('Enter a title for the event:');
                        if (title) {
                            $.ajax({
                                url: '/events',
                                method: 'POST',
                                contentType: 'application/json',
                                data: JSON.stringify({
                                    title: title,
                                    start: start.format(),
                                    end: end.format()
                                }),
                                success: function (data) {
                                    calendar.fullCalendar('renderEvent', data, true);
                                }
                            });
                        }
                        calendar.fullCalendar('unselect');
                    },

                    // Handle the update of existing events
                    eventDrop: function (event, delta, revertFunc) {
                        $.ajax({
                            url: '/events' + event.id,
                            method: 'PUT',
                            contentType: 'application/json',
                            data: JSON.stringify({
                                title: event.title,
                                start: event.start.format(),
                                end: (event.end ? event.end.format() : null)
                            }),
                            success: function (data) {
                                calendar.fullCalendar('updateEvent', data);
                            }
                        });
                    },

                    eventResize: function (event, delta, revertFunc) {
                        $.ajax({
                            url: '/events/' + event.id,
                            method: 'PUT',
                            contentType: 'application/json',
                            data: JSON.stringify({
                                title: event.title, start: event.start.format(),
                                end: (event.end ? event.end.format() : null)
                            }),
                            success: function (data) {
                                calendar.fullCalendar('updateEvent', data);
                            }
                        });
                    },

                    // Handle the delete of existing events
                    eventClick: function (event) {
                        if (confirm('Are you sure you want to delete this event?')) {
                            $.ajax({
                                url: '/events/' + event.id,
                                type: 'DELETE',
                                contentType: 'application/json',
                                success: function () {
                                    calendar.fullCalendar('removeEvents', event.id);
                                }
                            });
                        }
                    }

                });

            </script>

            {% endblock %}